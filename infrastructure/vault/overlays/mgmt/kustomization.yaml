---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - vault-config-job.yaml
  - vault-httproute.yaml

helmGlobals:
  chartHome: /tmp

helmCharts:
  - name: vault
    repo: https://helm.releases.hashicorp.com
    version: 0.28.0
    releaseName: vault
    namespace: vault
    valuesInline:
      server:
        dev:
          enabled: true        # dev mode for local â€” no unsealing needed
          devRootToken: "root" # in prod this is replaced by auto-unseal (AWS KMS)
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
          limits:
            cpu: 250m
            memory: 256Mi
        readinessProbe:
          exec:
            command:
              - /bin/sh
              - -ec
              - vault status -tls-skip-verify
          initialDelaySeconds: 10
          timeoutSeconds: 10    # increased from 3s
          periodSeconds: 10
          failureThreshold: 3
        livenessProbe:
          exec:
            command:
              - /bin/sh
              - -ec
              - vault status -tls-skip-verify
          initialDelaySeconds: 30
          timeoutSeconds: 10
          periodSeconds: 10
          failureThreshold: 3            
      ui:
        enabled: true          # gives you the Vault web UI
      injector:
        enabled: false         # we use ESO not the sidecar injector